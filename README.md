# VK Bot Framework

–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ü–µ–Ω, –∫–æ–º–∞–Ω–¥ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –≥–æ—Ç–æ–≤—ã–º —à–∞–±–ª–æ–Ω–æ–º
- üéÆ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- üìù –°–∏—Å—Ç–µ–º–∞ —Å—Ü–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞–º–∏
- ‚å®Ô∏è –£–¥–æ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏
- üóÑÔ∏è –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å MongoDB
- üîÑ –†–µ–∂–∏–º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

- Node.js 16 –∏–ª–∏ –≤—ã—à–µ
- MongoDB 4.4 –∏–ª–∏ –≤—ã—à–µ
- Git

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/your-username/vk-bot-build.git
cd vk-bot-build
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: development –∏–ª–∏ production
NODE_ENV=development

# –¢–æ–∫–µ–Ω –≥—Ä—É–ø–ø—ã –í–ö–æ–Ω—Ç–∞–∫—Ç–µ (–¥–ª—è production)
VK_TOKEN=your_token_here
VK_GROUP_ID=your_group_id

# MongoDB
MONGODB_URI=mongodb://localhost:27017/vkbot

# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
WEB_INTERFACE_ENABLED=true
WEB_INTERFACE_PORT=3001
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —à–∞–±–ª–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```bash
npm run dev:template
```

2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```
http://localhost:3001
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vk-bot-build/
‚îú‚îÄ‚îÄ lib/                    # –Ø–¥—Ä–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ index.js           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ database.js        # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îú‚îÄ‚îÄ web/                   # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
‚îú‚îÄ‚îÄ projects/              # –ü—Ä–æ–µ–∫—Ç—ã –±–æ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ template/         # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scenes/   # –°—Ü–µ–Ω—ã –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands/ # –ö–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants/# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keyboards/# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/        # –î–∞–Ω–Ω—ã–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ delivery/        # –ü—Ä–∏–º–µ—Ä –±–æ—Ç–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–∏—Ü—Ü—ã
‚îî‚îÄ‚îÄ package.json
```

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω:
```bash
cp -r projects/template projects/your-bot-name
```

2. –î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ package.json:
```json
{
  "scripts": {
    "dev:your-bot": "concurrently \"npm run dev:web\" \"cross-env NODE_ENV=development node projects/your-bot-name/index.js\"",
    "prod:your-bot": "cross-env NODE_ENV=production node projects/your-bot-name/index.js",
    "init:your-bot-db": "node projects/your-bot-name/data/init-db.js"
  }
}
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ src/constants/commands.js:
```javascript
const COMMANDS = {
    START: '–Ω–∞—á–∞—Ç—å',
    HELP: '–ø–æ–º–æ—â—å',
    // –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–º–∞–Ω–¥—ã
};
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –°—Ü–µ–Ω—ã

–°—Ü–µ–Ω—ã - —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ö–∞–∂–¥–∞—è —Å—Ü–µ–Ω–∞ –∏–º–µ–µ—Ç:
- enter: —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å—Ü–µ–Ω—É
- handle: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å—Ü–µ–Ω–µ
- leave: —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å—Ü–µ–Ω—ã

```javascript
// src/scenes/example.js
function createExampleScene(bot) {
    return {
        name: 'example',
        async enter(ctx) {
            await bot.reply(ctx, '–í—ã –≤–æ—à–ª–∏ –≤ —Å—Ü–µ–Ω—É');
        },
        async handle(ctx) {
            await bot.reply(ctx, '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è');
        }
    };
}
```

### –ö–æ–º–∞–Ω–¥—ã

–ö–æ–º–∞–Ω–¥—ã - —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:

```javascript
bot.commands.command({
    name: '–ø—Ä–∏–≤–µ—Ç',
    handler: async (ctx) => {
        await bot.reply(ctx, '–ü—Ä–∏–≤–µ—Ç!');
    }
});
```

### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã

–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

```javascript
function createKeyboard(bot) {
    return bot.keyboard('main', [
        [
            { text: '–ö–Ω–æ–ø–∫–∞ 1', color: 'primary' },
            { text: '–ö–Ω–æ–ø–∫–∞ 2', color: 'secondary' }
        ]
    ]);
}
```

## –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—ã
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (development)
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –≠–º—É–ª—è—Ü–∏—è API –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
- –ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∂–∏–º –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (production)
- –†–µ–∞–ª—å–Ω–æ–µ API –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç delivery –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞ —Å:
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º –º–µ–Ω—é
- –ö–æ—Ä–∑–∏–Ω–æ–π –ø–æ–∫—É–ø–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–ª–∞—Ç–µ–∂–µ–π
- –†–∞–±–æ—Ç–æ–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –°–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–∏–∞–ª–æ–≥–æ–≤

## API Reference

### Bot Class

```javascript
const { bot } = require('../../lib/index.js');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
await bot.init({
    dbUri: 'mongodb://localhost:27017/vkbot'
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
await bot.reply(ctx, '–¢–µ–∫—Å—Ç');
await bot.sendImg(ctx.peerId, 'url/to/image');

// –†–∞–±–æ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
await bot.setState(userId, 'scene_name');
const state = await bot.getState(userId);

// –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
await bot.addDocument('collection', data);
const docs = await bot.getAllDocuments('collection');
```

### Context Object

–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –¥–æ—Å—Ç—É–ø–µ–Ω –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
```javascript
{
    peerId: Number,      // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–±–µ—Å–µ–¥—ã
    message: {           // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏
        text: String,    // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
        payload: Object  // –î–∞–Ω–Ω—ã–µ –æ—Ç –∫–Ω–æ–ø–æ–∫
    },
    setState: Function,  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    getState: Function,  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    setUserData: Function, // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    getUserData: Function  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–§—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç winston –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª bot.log:
```javascript
// –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
bot.logger.info('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
bot.logger.error('–û—à–∏–±–∫–∞', error);
bot.logger.debug('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è');
```

### –†–∞–±–æ—Ç–∞ —Å payload –≤ –∫–Ω–æ–ø–∫–∞—Ö

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ payload –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É:

```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å payload
const button = {
    text: '–ö–Ω–æ–ø–∫–∞',
    color: 'primary',
    payload: { 
        command: 'action',
        data: { id: 123 }
    }
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ payload
async handle(ctx) {
    let payload = ctx.message?.payload || ctx.messagePayload;
    
    // –í development payload –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞
    if (typeof payload === 'string') {
        payload = JSON.parse(payload);
    }
    
    if (payload?.command === 'action') {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã
    }
}
```

### –û—Ç–ª–∞–¥–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- MongoDB Compass
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ (–≤–∫–ª–∞–¥–∫–∞ Database)
- –ú–µ—Ç–æ–¥—ã –±–æ—Ç–∞:
  ```javascript
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
  const collections = await bot.getCollections();
  
  // –ü–æ–ª—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
  const docs = await bot.getAllDocuments('collection');
  
  // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é
  await bot.clearCollection('collection');
  ```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
